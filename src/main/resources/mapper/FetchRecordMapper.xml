<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.plz.modules.mapper.FetchRecordMapper">
  <resultMap id="BaseResultMap" type="com.plz.modules.model.FetchRecord">
    <result column="t_id" jdbcType="INTEGER" property="id" />
    <result column="t_odd" jdbcType="VARCHAR" property="odd" />
    <result column="t_warehouseId" jdbcType="INTEGER" property="warehouseId" />
    <result column="t_discount" jdbcType="FLOAT" property="discount" />
    <result column="t_other_cost" jdbcType="DOUBLE" property="otherCost" />
    <result column="t_other_costName" jdbcType="VARCHAR" property="otherCostName" />
    <result column="t_paid" jdbcType="DOUBLE" property="paid" />
    <result column="t_remake" jdbcType="VARCHAR" property="remark" />
    <result column="t_customId" jdbcType="INTEGER" property="customId" />
    <result column="t_signer" jdbcType="VARCHAR" property="signer" />
    <result column="t_receiver" jdbcType="VARCHAR" property="receiver" />
    <result column="t_receiver_phone" jdbcType="VARCHAR" property="receiverPhone" />
    <result column="t_receivedId" jdbcType="INTEGER" property="receiverId" />
    <result column="t_received_address" jdbcType="VARCHAR" property="receivedAddress" />
    <result column="t_received_time" jdbcType="TIMESTAMP" property="receivedTime" />
    <result column="t_deal_time" jdbcType="TIMESTAMP" property="dealTime" />
    <result column="t_state" jdbcType="TINYINT" property="state" />
    <result column="t_create_date" jdbcType="TIMESTAMP" property="createTime" />
    <collection property="fetchGoodsRecordList" javaType="java.util.ArrayList" ofType="com.plz.modules.model.FetchGoodsRecord"
                select="com.plz.modules.mapper.FetchGoodsRecordMapper.selectByRecordId" column="{recordId=t_id}"/>
  </resultMap>

  <sql id="Base_Column">
    t_id, t_odd, t_warehouseId, t_discount, t_other_cost, t_other_cost_name, t_paid, t_remark, t_customId,
    t_signer, t_receiver, t_receiver_phone, t_receivedId, t_received_address, t_received_time, t_deal_time,
    t_state, t_create_time
  </sql>

  <select id="list" resultMap="BaseResultMap">
    SELECT
        <include refid="Base_Column" />
    FROM
        t_fetch_record
    WHERE 1=1
    <if test="query.warehouseId != null" >
        AND t_warehouseId = #{query.warehouseId}
    </if>
    <if test="query.odd != null and query.odd != ''" >
        AND t_odd LIKE concat('%', #{query.odd}, '%')
    </if>
    <if test="query.customId != null" >
        AND t_customId = #{query.customId}
    </if>
    ORDER BY t_create_time DESC
  </select>

  <update id="deliver">
    UPDATE t_fetch_record SET t_state = 2 WHERE t_id = #{id} AND t_state = 1
  </update>

  <update id="sign">
    UPDATE t_fetch_record SET t_state = 3 WHERE t_id = #{id} AND t_state = 2
  </update>

</mapper>